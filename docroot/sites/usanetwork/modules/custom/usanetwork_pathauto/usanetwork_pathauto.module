<?php
/**
 * @file
 * Code for the usanetwork_pathauto feature.
 */

include_once 'usanetwork_pathauto.features.inc';

/**
 * Implements hook_pathauto_alias_alter
 */
function usanetwork_pathauto_pathauto_alias_alter(&$alias, array &$context) {
  if (($context['module'] == 'node') && (in_array($context['type'], array('usanetwork_promo', 'person', 'media_gallery', 'quiz', 'catchall_page')))) {
    $node = $context['data']['node'];
    $movie_field = _usanetwork_get_field_item('node', $node, 'field_movie', 'target_id');
    if ($movie_field) {
      $movie = node_load($movie_field);
      module_load_include('inc', 'pathauto', 'pathauto');
      $movie_title = pathauto_cleanstring($movie->title);
      $alias = 'movies/' . $movie_title . '/' . $alias;
    }
  }
}
