<?php
/**
 * @file
 * Code for the USA Network Taboola.
 */

/**
 * Implements hook_block_info().
 */
function usanetwork_taboola_block_info()
{
  $blocks['usanetwork_taboola_video'] = array(
    'info' => t('Usanetwork Taboola Video'),
    'cache' => DRUPAL_NO_CACHE,
  );
  $blocks['usanetwork_taboola_gallery'] = array(
    'info' => t('Usanetwork Taboola Gallery'),
    'cache' => DRUPAL_NO_CACHE,
  );

  return $blocks;
}

/**
 * Implements hook_block_view().
 */
function usanetwork_taboola_block_view($delta = '')
{
  $block = array();

  switch ($delta) {
    case 'usanetwork_taboola_video':
      $block['subject'] = t('');
      $block['content'] = _usanetwork_taboola_video_block();
      break;
    case 'usanetwork_taboola_gallery':
      $block['subject'] = t('');
      $block['content'] = _usanetwork_taboola_gallery_block();
      break;
  }
  return $block;
}

/*
 * Taboola Block for Video Page
 */
function _usanetwork_taboola_video_block() {
  drupal_add_js(drupal_get_path('module', 'usanetwork_taboola') . '/js/usanetwork_taboola_header.js', array('type' => 'file', 'scope' => 'header'));
  drupal_add_js(drupal_get_path('module', 'usanetwork_taboola') . '/js/usanetwork_taboola_footer.js', array('type' => 'file', 'scope' => 'footer'));

  $output = '<div id="taboola-below-player-thumbnails"></div>
<script type="text/javascript">
  window._taboola = window._taboola || [];
  _taboola.push({
    mode: \'thumbnails-a\',
    container: \'taboola-below-player-thumbnails\',
    placement: \'Below Player Thumbnails\',
    target_type: \'mix\'
  });
</script>';

  $variables = array('output' => $output);

  return theme('usanetwork_taboola', $variables);
}

/*
 * Taboola Block for Megia Gallery Page
 */
function _usanetwork_taboola_gallery_block() {
  drupal_add_js(drupal_get_path('module', 'usanetwork_taboola') . '/js/usanetwork_taboola_header.js', array('type' => 'file', 'scope' => 'header'));
  drupal_add_js(drupal_get_path('module', 'usanetwork_taboola') . '/js/usanetwork_taboola_footer.js', array('type' => 'file', 'scope' => 'footer'));

  $output = '<div id="taboola-below-gallery-thumbnails"></div>
<script type="text/javascript">
  window._taboola = window._taboola || [];
  _taboola.push({
    mode: \'thumbnails-a\',
    container: \'taboola-below-gallery-thumbnails\',
    placement: \'Below Gallery Thumbnails\',
    target_type: \'mix\'
  });
</script>';

  $variables = array('output' => $output);

  return theme('usanetwork_taboola', $variables);
}

/**
 * Implements hook_theme().
 */
function usanetwork_taboola_theme($existing, $type, $theme, $path)
{
  return array(
    'usanetwork_taboola' => array(
      'variables' => array(
        'output' => NULL,
      ),
      'path' => $path . '/templates',
      'template' => 'usanetwork-taboola',
    ),
  );
}
